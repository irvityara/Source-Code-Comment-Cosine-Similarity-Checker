<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Cosine Similarity Checker</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background: #f8f9fa;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        align-items: center;
      }

      .card {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      textarea {
        font-size: 14px;
      }

      .chart-box canvas {
        max-width: 260px;
        max-height: 260px;
        margin: auto;
      }

      @media (max-width: 768px) {
        .row {
          flex-direction: column;
        }

        #similarityChart {
          margin-top: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container mb-5" style="max-width: 1000px; padding: 20px">
      <h2
        class="mb-4 text-center"
        style="margin-top: 20px; margin-bottom: 20px"
      >
        Source Code Comment Cosine Similarity Checker
      </h2></br>

      <div class="row g-4">
        <!-- Input Card -->
        <div class="col-md-6">
          <div class="card p-4 h-100">
            <div class="mb-3">
              <label for="text1" class="form-label">Original Comment:</label>
              <textarea
                class="form-control"
                id="text1"
                rows="4"
                style="resize: vertical"
                placeholder="Enter original comment..."
              ></textarea>
            </div>
            <div class="mb-3">
              <label for="text2" class="form-label"
                >Comment Generated by AI:</label
              >
              <textarea
                class="form-control"
                id="text2"
                rows="4"
                style="resize: vertical"
                placeholder="Enter generated comment..."
              ></textarea>
            </div>
            <div class="d-grid gap-2">
              <button class="btn btn-primary" onclick="computeSimilarity()">
                Calculate Similarity
              </button>
            </div>
          </div>
        </div>

        <!-- Result Card with Chart -->
        <div class="col-md-6">
          <div
            class="card p-4 h-100 d-flex flex-column justify-content-between"
          >
            <div class="result-box">
              <h5>Similarity Result:</h5>
              <div id="result" class="alert alert-info" role="alert">
                Please enter original comment by human developer and comment
                generated by AI to calculate their similarity.
              </div>
            </div>
            <div class="chart-box text-center">
              <canvas id="similarityChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      async function computeSimilarity() {
        const text1 = document.getElementById("text1").value;
        const text2 = document.getElementById("text2").value;

        const resultBox = document.getElementById("result");
        resultBox.classList.remove(
          "alert-danger",
          "alert-success",
          "alert-info"
        );
        resultBox.classList.add("alert-info");
        resultBox.innerText = "Calculating...";

        try {
          const response = await fetch("/similarity", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text1, text2 }),
          });

          const data = await response.json();
          if (response.ok) {
            resultBox.classList.remove("alert-info");
            resultBox.classList.add("alert-success");
            resultBox.innerText = `Cosine Similarity: ${data.similarity}`;

            resultBox.classList.remove("alert-info");
            resultBox.classList.add("alert-success");
            resultBox.innerText = `Cosine Similarity: ${data.similarity}`;
            updatePieChart(data.similarity); // Tambahkan baris ini
          } else {
            resultBox.classList.remove("alert-info");
            resultBox.classList.add("alert-danger");
            resultBox.innerText = data.error || "An error occurred";
          }
        } catch (err) {
          resultBox.classList.remove("alert-info");
          resultBox.classList.add("alert-danger");
          resultBox.innerText = "Failed to connect to the server";
        }
      }

      let chartInstance = null;

      function updatePieChart(similarity) {
        const ctx = document.getElementById("similarityChart").getContext("2d");
        const difference = 1 - similarity;

        const data = {
          labels: ["Similarity", "Insimilarity"],
          datasets: [
            {
              data: [similarity, difference],
              backgroundColor: ["#198754", "#dc3545"],
              hoverOffset: 4,
            },
          ],
        };

        if (chartInstance) {
          chartInstance.destroy(); // destroy previous chart if exists
        }

        chartInstance = new Chart(ctx, {
          type: "pie",
          data: data,
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "bottom",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${(context.parsed * 100).toFixed(
                      2
                    )}%`;
                  },
                },
              },
            },
          },
        });
      }
    </script>
  </body>
</html>
